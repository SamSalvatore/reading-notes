[TOC]
# MySQL必知必会

## 第一章 了解SQL
数据库：保存有组织的数据的容器（通常是一个文件或一组文件）

> 就本书而言数据库是一个以某种有组织的方式存储的数据集合。理解数据库的一种最简单的办法是将其想象为一个文件柜。此文件柜是一个存放数据的物理位置，不管数据是什么以及如何组织的。

表: 某种特定类型数据的结构化清单

模式(schema)：关于数据库和表的布局及特性的信息

列(column):表中的一个字段。所有的表都是由一个或多个列组成的。

数据类型(datatype):所容许的数据的类型。每个表列都有相应的数据类型，它限制（或容许）该列中存储的数据

行(row):表中的一个记录

主键(primary key):一列（或一组列），其值能够唯一区分表中每个行
* 应该总是定义主键
* 主键需要满足条件
    * 任意两行都不具有相同的主键值
    * 每个行都必须具有一个主键值（主键列不允许NULL值）

主键的最好习惯
* 不更新主键列中的值
* 不重用主键列的值
* 不在主键列中使用可能会更改的值

## 第二章 MySQL简介
为什么有那么多的公司和开发人员使用MySQL？
* 成本——MySQL是开放源代码的，一般可以免费使用（甚至可以 免费修改）。
* 性能——MySQL执行很快（非常快）。 
* 可信赖——某些非常重要和声望很高的公司、站点使用MySQL。
* 简单——MySQL很容易安装和使用。

MySQL命令行实用程序
* 命令输入在mysql>之后； 
* 命令用;或\g结束，换句话说，仅按Enter不执行命令； 
* 输入help或\h获得帮助，也可以输入更多的文本获得特定命令的 帮助（如，输入help select获得使用SELECT语句的帮助）；
* 输入quit或exit退出命令行实用程序。 

## 第三章 使用MySQL




## 第7章

### IN操作符
`IN`操作符用来指定条件范围，范围中的每个条件都可以进行匹配。`IN`取合法值的由逗号分隔的清单，全都括在圆括号中。IN操作符完成与OR相同的功能。

为什么要使用IN操作符？其优点具体如下。
* 在使用长的合法选项清单时，IN操作符的语法更清楚且更直观。 
*  在使用IN时，计算的次序更容易管理（因为使用的操作符更少）。 
*  IN操作符一般比OR操作符清单执行更快。 
*  IN的最大优点是可以包含其他SELECT语句，使得能够更动态地建立WHERE子句。

类似语句： NOT IN

## 第8章 用通配符进行过滤
### LIKE
`LIKE`操作符通常用于基于模式查询选择数据。以正确的方式使用`LIKE`运算符对于增加/减少查询性能至关重要。
`LIKE`操作符允许您根据指定的模式从表中查询选择数据。 因此，`LIKE`运算符通常用在`SELECT`语句的`WHERE`子句中。
`MySQL`提供两个通配符，用于与LIKE运算符一起使用，它们分别是：百分比符号 `%`和下划线`_`

* `%`通配符:在搜索串中，`%`表示任何字符出现任意次数。
* 下划线（`_`）通配符: `_`只匹配单个字符而不是多个字符。


使用通配符要记住的技巧。
* 不要过度使用通配符。如果其他操作符能达到相同的目的，应该使用其他操作符。
* 在确实需要使用通配符时，除非绝对有必要，否则不要把它们用在搜索模式的开始处。把通配符置于搜索模式的开始处，搜索起来是最慢的。
* 仔细注意通配符的位置。如果放错地方，可能不会返回想要的数据。

## 第9章 用正则表达式进行搜索
MySQL中的正则表达式匹配（自版本 
3.23.4后）不区分大小写（即，大写和小写都匹配）。为区分大 小写， 可使用 `BINARY` 关键字， 如 
`WHERE prod_name REGEXP BINARY 'JetPack .000'`


注：
MySQL的LIKE、REGEXP 都是不区分大小写的。如果想区分的话，可以在建表的时候将字段名设置为Binary属性
```sql
alter  table `conan_english_dialog`.`writing_material` change name name varchar(255) BINARY NOT NULL DEFAULT '' COMMENT '素材名称';
```
也可以在查询SQL上写上BINARY

```sql
SELECT * FROM address WHERE district LIKE BINARY  '%m%'
```



## 第10章 创建计算字段
### 计算字段的目的
存储在表中的数据都不是应用程序所需要的。 我们需要直接从数据库中检索出【转换、计算或格式化过】的数据；而不是检索出数据，然后再在客户机应用程序或报告程序中重新格式化。

计算字段并不实际存在于数据库表中。计算字段是运行时在`SELECT`语句内创建的。


### Concat()
Concat() 拼接串， 即把多个串连接起来形成一个较长的串。 Concat()需要一个或多个指定的串，各个串之间用逗号分隔。

### Trim函数
* RTrim():去掉串右边的空格）
* LTrim():（去掉串左边的空格）
* Trim():（去掉串左右两边的空格）

```sql
select concat(RTrim(vend_name), '(', RTrim(vend_country), ')') from vendors order by vend_name;
```

### 使用别名
* 别名（alias）是一个字段或值的替换名。别名用`AS`关键字赋予.
* 别名有时也称为导出列（derived column）


### MySQL算数运算符
* `+` 
* `-` 
* `*` 
* `/`

## 第11章 使用数据处理函数
### 常用的文本处理函数
* `Left()`: 返回串左边的字符
* `Length()`: 返回串的长度
* `Locate()`: 找出串的一个子串
* `Lower()`: 将串转换为小写
* `LTrim()`: 去掉串左边的空格
* `Right()`: 返回串右边的字符
* `RTrim()`: 去掉串右边的空格
* `SubString()`: 返回子串的字符
* `Upper()`:将串转化为大写

### 日期和时间处理函数
用的比较多的就是MySQL中的now()函数，返回当前日期和时间(注：返回的不是时间戳)
![-w895](https://it-learn-1259257911.cos.ap-beijing.myqcloud.com/2019/09/30/15697604308690.jpg)

`unix_timestamp()`: 返回当前时间的时间戳（单位为秒）
`UNIX_TIMESTAMP(date)`:若用date 来调用 UNIX_TIMESTAMP()，它会将参数值以'1970-01-01 00:00:00' GMT后的**秒数**的形式返回。date 可以是一个 DATE **字符串**、一个 DATETIME字符串、一个 TIMESTAMP或一个当地时间的YYMMDD 或YYYMMDD格式的数字。

![-w806](https://it-learn-1259257911.cos.ap-beijing.myqcloud.com/2019/09/30/15697597212114.jpg)

## 第12章 汇总数据
* `AVG()` :返回某列的平均值
    * 忽略列值为NULL的行
* `COUNT()`:返回某列的行数
    * 如果指定列名，则指定列的值为空的行被COUNT()函数忽略
    * 如果COUNT（）函数中用的是星号`*`,则不忽略
* `MAX()`：返回某列的最大值
    * 忽略列值为NULL的行
* `MIN()`：返回某列的最小值
    * 忽略列值为NULL的行
* `SUM()`：返回某列值之和
    * 忽略列值为NULL的行

## 第13章 分组数据
 * GROUP BY
 * HAVING

### GROUP BY
 
`GROUP BY` 字句必须出现在`WHERE`字句之后，`ORDER BY`字句之前。

### HAVING
`WHERE`过滤指定的是行而不是分组。`HAVING`非常类似于`WHERE`。`WHERE`过滤行，而`HAVING`过滤分组。

```sql
SELECT cust_id, count(*) AS orders FROM orders GROUP BY cust_id HAVING COUNT(*) >=2
```

>HAVING和WHERE的差别:这里有另一种理解方法，WHERE在数据分组前进行过滤。HAVING在数据分组后进行过滤。这是一个重
要的区别，WHERE排除的行不包括在分组中。这可能会改变计算值，从而影响HAVING子句中基于这些值过滤掉的分组。

### 分组与排序

| ORDER BY | GROUP BY |
| --- | --- |
| 排序产生的输出 | 分组行。但输出可能不是分组的顺序 |
| 任意列都可以使用（甚至非选择的列也可与使用） | 只可能使用选择列或表达式列，而且必须使用每个选择列表达式 |
| 不一定需要 | 如果与聚集函数一起使用列（或表达式），则必须使用 |

### SELECT 子句顺序

| 字句 | 说明 | 是否必须使用 |
| --- | --- | --- |
| SELECT | 要返回的列或表达式 | 是 |
| FROM | 从中检索数据的表 | 仅在从表选择数据时使用 |
| WHERE | 行级过滤 | 否 |
| GROUP BY | 分组说明 | 仅在按组计算聚集时使用 |
| HAVING | 组级过滤 | 否 |
| ORDER BY | 输出排序顺序 | 否 |
| LIMIT | 要检索的行数 | 否 |

## 第14章 使用子查询
**使用场景**
子查询最常用的使用是在WHERE字句的IN操作符中，以及用来填充计算列。

### 利用子查询进行过滤
![-w1263](https://it-learn-1259257911.cos.ap-beijing.myqcloud.com/2019/09/30/15697724425209.jpg)

### 作为计算字段使用子查询
![-w1732](https://it-learn-1259257911.cos.ap-beijing.myqcloud.com/2019/09/30/15697731520749.jpg)

需要注意的是，子查询中的`WHERE`字句使用了完全限定列名。
```sql
WHERE orders.cust_id = customers.cust_id
```
这种类型的子查询称为**相关子查询**。任何时候只要列名可能有多义性，就必须使用这种语法（表明和列名由一个句点分隔）。
## 第15章 联结表
